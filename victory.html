<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Victory Royale Survivor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
      50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
    }
    @keyframes storm-pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 0.8; }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    @keyframes victory-burst {
      0% { transform: scale(0.5); opacity: 0; }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes storm-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes storm-swirl {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.05); }
      100% { transform: rotate(360deg) scale(1); }
    }
    @keyframes lightning-flash {
      0%, 100% { opacity: 0; }
      50% { opacity: 0.3; }
    }
    .victory-animate {
      animation: victory-burst 0.6s ease-out forwards;
    }
    .storm-zone {
      animation: storm-pulse 2s ease-in-out infinite;
    }
    .loot-float {
      animation: float 2s ease-in-out infinite;
    }
    .win-glow {
      animation: pulse-glow 1.5s ease-in-out infinite;
    }
    .game-font {
      font-family: 'Bebas Neue', sans-serif;
    }
    .body-font {
      font-family: 'Roboto', sans-serif;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0 body-font">
  <div id="app" class="h-full w-full overflow-auto"><!-- Start Screen -->
   <div id="start-screen" class="h-full w-full flex flex-col items-center justify-center p-6" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
    <div class="text-center max-w-lg">
     <div class="mb-6"><span class="text-7xl">üéÆ</span>
     </div>
     <h1 id="title-display" class="game-font text-5xl md:text-6xl mb-4 tracking-wider" style="color: #ffd700; text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);">VICTORY ROYALE SURVIVOR</h1>
     <p class="text-lg mb-8" style="color: #e94560;">Survive the storm, collect loot, eliminate enemies!</p>
     <div class="space-y-4 mb-8 text-left p-6 rounded-xl" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 215, 0, 0.2);">
      <h3 class="game-font text-xl mb-3" style="color: #ffd700;">HOW TO PLAY</h3>
      <p style="color: #a0a0a0;"><span style="color: #ffd700;">‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è</span> or <span style="color: #ffd700;">WASD</span> - Move your character</p>
      <p style="color: #a0a0a0;"><span style="color: #ffd700;">üì¶</span> Collect loot to gain health &amp; eliminate enemies</p>
      <p style="color: #a0a0a0;"><span style="color: #e94560;">üåÄ</span> Avoid the purple storm zone!</p>
      <p style="color: #a0a0a0;"><span style="color: #ffd700;">üèÜ</span> Be the last one standing!</p>
     </div><button id="start-btn" class="game-font text-2xl px-12 py-4 rounded-lg transition-all duration-300 hover:scale-105 cursor-pointer border-none" style="background: linear-gradient(135deg, #ffd700, #ff8c00); color: #1a1a2e; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);"> DROP IN! ü™Ç </button>
    </div>
   </div><!-- Game Screen -->
   <div id="game-screen" class="h-full w-full hidden flex-col" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);"><!-- HUD -->
    <div class="p-4 flex justify-between items-center flex-wrap gap-4" style="background: rgba(0, 0, 0, 0.5);">
     <div class="flex items-center gap-6">
      <div class="flex items-center gap-2"><span class="text-2xl">‚ù§Ô∏è</span>
       <div class="w-32 h-4 rounded-full overflow-hidden" style="background: rgba(255, 255, 255, 0.2);">
        <div id="health-bar" class="h-full transition-all duration-300" style="background: linear-gradient(90deg, #22c55e, #16a34a); width: 100%;"></div>
       </div><span id="health-text" class="game-font text-lg" style="color: #22c55e;">100</span>
      </div>
      <div class="flex items-center gap-2"><span class="text-2xl">üõ°Ô∏è</span>
       <div class="w-24 h-4 rounded-full overflow-hidden" style="background: rgba(255, 255, 255, 0.2);">
        <div id="shield-bar" class="h-full transition-all duration-300" style="background: linear-gradient(90deg, #3b82f6, #1d4ed8); width: 0%;"></div>
       </div><span id="shield-text" class="game-font text-lg" style="color: #3b82f6;">0</span>
      </div>
     </div>
     <div class="flex items-center gap-6">
      <div class="text-center">
       <p class="text-xs" style="color: #a0a0a0;">ALIVE</p>
       <p id="alive-count" class="game-font text-2xl" style="color: #ffd700;">50</p>
      </div>
      <div class="text-center">
       <p class="text-xs" style="color: #a0a0a0;">ELIMINATIONS</p>
       <p id="elim-count" class="game-font text-2xl" style="color: #e94560;">0</p>
      </div>
      <div class="text-center">
       <p class="text-xs" style="color: #a0a0a0;">STORM IN</p>
       <p id="storm-timer" class="game-font text-2xl" style="color: #a855f7;">30s</p>
      </div>
     </div>
    </div><!-- Game Arena -->
    <div class="flex-1 relative overflow-hidden p-2">
     <div id="arena" class="w-full h-full relative rounded-xl overflow-hidden" style="background: linear-gradient(180deg, #87CEEB 0%, #90EE90 40%, #6B8E23 60%, #8B7355 100%); border: 3px solid #ffd700; box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.3); position: relative;"><!-- Sky gradient -->
      <div class="absolute inset-0 pointer-events-none" style="background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 40%, #90EE90 70%, #6B8E23 100%);"></div><!-- Mountain peaks - left side -->
      <svg class="absolute inset-0 w-full h-full pointer-events-none" style="overflow: visible;"><!-- Left mountain --> <polygon points="0,100% 15%,25% 30%,100%" fill="#8B7355" opacity="0.8" /> <polygon points="5%,100% 15%,28% 25%,100%" fill="#A0826D" opacity="0.6" /> <!-- Right mountains --> <polygon points="70%,100% 85%,35% 100%,100%" fill="#696969" opacity="0.75" /> <polygon points="75%,100% 85%,38% 95%,100%" fill="#808080" opacity="0.5" /> <!-- Center peaks --> <polygon points="40%,100% 50%,20% 60%,100%" fill="#654321" opacity="0.7" />
      </svg><!-- Forest areas -->
      <div class="absolute inset-0 pointer-events-none"><!-- Dense forest - top left -->
       <div style="position: absolute; left: 5%; top: 35%; width: 25%; height: 35%; background: radial-gradient(ellipse at center, rgba(34, 139, 34, 0.5) 0%, rgba(46, 125, 50, 0.7) 50%, rgba(27, 94, 32, 0.9) 100%); border-radius: 60% 40% 45% 55% / 50% 60% 30% 60%;"></div><!-- Forest - top right -->
       <div style="position: absolute; right: 8%; top: 40%; width: 20%; height: 30%; background: radial-gradient(ellipse at center, rgba(46, 125, 50, 0.6) 0%, rgba(27, 94, 32, 0.8) 100%); border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;"></div><!-- Forest - bottom left -->
       <div style="position: absolute; left: 12%; bottom: 5%; width: 30%; height: 25%; background: radial-gradient(ellipse at center, rgba(34, 139, 34, 0.4) 0%, rgba(27, 94, 32, 0.8) 100%); border-radius: 40% 60% 70% 30% / 40% 50% 50% 60%;"></div>
      </div><!-- Water/Rivers -->
      <div class="absolute inset-0 pointer-events-none"><!-- River 1 - winding through map -->
       <svg style="position: absolute; width: 100%; height: 100%; overflow: visible;"><path d="M 50% 0% Q 45% 30%, 55% 50% T 50% 100%" stroke="#4A90E2" stroke-width="8" fill="none" opacity="0.6" /> <!-- River 2 --> <path d="M 20% 40% Q 30% 60%, 25% 80%" stroke="#4A90E2" stroke-width="6" fill="none" opacity="0.5" />
       </svg>
      </div><!-- Buildings/Structures (POIs) -->
      <div class="absolute inset-0 pointer-events-none text-3xl" style="font-size: 2rem;"><!-- Castle/Fort - top center -->
       <div style="position: absolute; left: 48%; top: 22%; transform: translate(-50%, -50%); opacity: 0.8;">
        üè∞
       </div><!-- City/Town - left side -->
       <div style="position: absolute; left: 18%; top: 55%; transform: translate(-50%, -50%); opacity: 0.8;">
        üèôÔ∏è
       </div><!-- Factory - right side -->
       <div style="position: absolute; right: 15%; top: 45%; transform: translate(-50%, -50%); opacity: 0.8;">
        üè≠
       </div><!-- Farm - bottom left -->
       <div style="position: absolute; left: 25%; bottom: 15%; transform: translate(-50%, -50%); opacity: 0.8;">
        üöú
       </div><!-- Harbor/Dock - bottom right -->
       <div style="position: absolute; right: 18%; bottom: 12%; transform: translate(-50%, -50%); opacity: 0.8;">
        ‚õµ
       </div><!-- Small village - right middle -->
       <div style="position: absolute; right: 25%; top: 68%; transform: translate(-50%, -50%); opacity: 0.7;">
        üè†
       </div>
      </div><!-- Road/Path overlay -->
      <div class="absolute inset-0 pointer-events-none" style="background-image: 
            linear-gradient(45deg, transparent 48%, rgba(200, 180, 140, 0.2) 49%, rgba(200, 180, 140, 0.2) 51%, transparent 52%),
            linear-gradient(-45deg, transparent 48%, rgba(200, 180, 140, 0.15) 49%, rgba(200, 180, 140, 0.15) 51%, transparent 52%);
            background-size: 200px 200px;
            background-position: 0 0;"></div><!-- Cloud shadows -->
      <div class="absolute inset-0 pointer-events-none opacity-20" style="background-image: 
            radial-gradient(ellipse 300px 100px at 20% 30%, rgba(0, 0, 0, 0.3) 0%, transparent 100%),
            radial-gradient(ellipse 250px 80px at 75% 20%, rgba(0, 0, 0, 0.25) 0%, transparent 100%),
            radial-gradient(ellipse 280px 90px at 50% 70%, rgba(0, 0, 0, 0.2) 0%, transparent 100%);"></div><!-- Storm Zone - Clear purple circle that closes in -->
      <div id="storm-zone" class="absolute pointer-events-none rounded-full" style="left: 50%; top: 50%; transform: translate(-50%, -50%); width: 200%; height: 200%; background: radial-gradient(circle at center, transparent 0%, transparent 40%, rgba(138, 43, 226, 0.3) 50%, rgba(75, 0, 130, 0.6) 70%, rgba(75, 0, 130, 0.9) 100%); animation: storm-swirl 6s linear infinite; box-shadow: inset 0 0 100px rgba(138, 43, 226, 0.5), inset 0 0 50px rgba(138, 43, 226, 0.8);"></div><!-- Storm wall - glowing purple ring -->
      <div id="storm-ring" class="absolute pointer-events-none" style="left: 50%; top: 50%; transform: translate(-50%, -50%); width: 150%; height: 150%; border: 8px solid rgba(138, 43, 226, 0.8); border-radius: 50%; box-shadow: 0 0 60px rgba(138, 43, 226, 0.9), inset 0 0 40px rgba(138, 43, 226, 0.7); animation: pulse-glow 2s ease-in-out infinite;"></div><!-- Lightning bolts -->
      <div class="absolute inset-0 pointer-events-none" style="animation: lightning-flash 4s ease-in-out infinite;">
       <div style="position: absolute; left: 30%; top: 20%; width: 3px; height: 80px; background: linear-gradient(to bottom, rgba(255, 255, 255, 0.8), rgba(138, 43, 226, 0.5)); clip-path: polygon(0 0, 100% 15%, 80% 40%, 100% 60%, 70% 85%, 100% 100%, 0 85%, 30% 60%, 0 40%, 20% 15%);"></div>
       <div style="position: absolute; right: 25%; top: 35%; width: 2px; height: 60px; background: linear-gradient(to bottom, rgba(255, 255, 255, 0.6), rgba(138, 43, 226, 0.4)); clip-path: polygon(0 0, 100% 20%, 70% 50%, 100% 80%, 0 100%, 30% 70%, 0 40%);"></div>
      </div><!-- Player -->
      <div id="player" class="absolute w-10 h-10 flex items-center justify-center text-3xl cursor-pointer z-20 transition-transform duration-100" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
       üßë‚ÄçüöÄ
      </div><!-- Loot Container -->
      <div id="loot-container" class="absolute inset-0 pointer-events-none z-10"></div><!-- Enemy Container -->
      <div id="enemy-container" class="absolute inset-0 pointer-events-none z-10"></div><!-- Effects Container -->
      <div id="effects-container" class="absolute inset-0 pointer-events-none z-30"></div>
     </div>
    </div><!-- Mobile Controls -->
    <div id="mobile-controls" class="p-4 flex justify-center gap-2 md:hidden" style="background: rgba(0, 0, 0, 0.5);">
     <div class="grid grid-cols-3 gap-2">
      <div></div><button class="control-btn text-2xl w-14 h-14 rounded-lg flex items-center justify-center" style="background: rgba(255, 215, 0, 0.2); border: 2px solid #ffd700;" data-dir="up">‚¨ÜÔ∏è</button>
      <div></div><button class="control-btn text-2xl w-14 h-14 rounded-lg flex items-center justify-center" style="background: rgba(255, 215, 0, 0.2); border: 2px solid #ffd700;" data-dir="left">‚¨ÖÔ∏è</button> <button class="control-btn text-2xl w-14 h-14 rounded-lg flex items-center justify-center" style="background: rgba(255, 215, 0, 0.2); border: 2px solid #ffd700;" data-dir="down">‚¨áÔ∏è</button> <button class="control-btn text-2xl w-14 h-14 rounded-lg flex items-center justify-center" style="background: rgba(255, 215, 0, 0.2); border: 2px solid #ffd700;" data-dir="right">‚û°Ô∏è</button>
     </div>
    </div>
   </div><!-- Victory Screen -->
   <div id="victory-screen" class="h-full w-full hidden flex-col items-center justify-center p-6" style="background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);">
    <div class="text-center victory-animate">
     <div class="mb-6 text-8xl">
      üèÜ
     </div>
     <h1 id="victory-title" class="game-font text-5xl md:text-7xl mb-4 win-glow rounded-xl px-8 py-4" style="color: #ffd700; background: rgba(255, 215, 0, 0.1);">VICTORY ROYALE!</h1>
     <p class="text-xl mb-8" style="color: #e94560;">You outlasted everyone!</p>
     <div class="flex justify-center gap-8 mb-8">
      <div class="text-center p-4 rounded-xl" style="background: rgba(255, 255, 255, 0.05);">
       <p class="text-sm" style="color: #a0a0a0;">ELIMINATIONS</p>
       <p id="final-elims" class="game-font text-4xl" style="color: #e94560;">0</p>
      </div>
      <div class="text-center p-4 rounded-xl" style="background: rgba(255, 255, 255, 0.05);">
       <p class="text-sm" style="color: #a0a0a0;">SURVIVAL TIME</p>
       <p id="final-time" class="game-font text-4xl" style="color: #22c55e;">0:00</p>
      </div>
     </div><button id="play-again-btn" class="game-font text-2xl px-12 py-4 rounded-lg transition-all duration-300 hover:scale-105 cursor-pointer border-none" style="background: linear-gradient(135deg, #ffd700, #ff8c00); color: #1a1a2e; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);"> PLAY AGAIN üîÑ </button>
    </div>
   </div><!-- Game Over Screen -->
   <div id="gameover-screen" class="h-full w-full hidden flex-col items-center justify-center p-6" style="background: linear-gradient(135deg, #1a1a2e 0%, #3d1a1a 100%);">
    <div class="text-center">
     <div class="mb-6 text-8xl">
      üíÄ
     </div>
     <h1 class="game-font text-5xl md:text-6xl mb-4" style="color: #e94560;">ELIMINATED</h1>
     <p id="placement" class="text-xl mb-8" style="color: #a0a0a0;">You placed #<span id="place-num">1</span></p>
     <div class="flex justify-center gap-8 mb-8">
      <div class="text-center p-4 rounded-xl" style="background: rgba(255, 255, 255, 0.05);">
       <p class="text-sm" style="color: #a0a0a0;">ELIMINATIONS</p>
       <p id="go-elims" class="game-font text-4xl" style="color: #e94560;">0</p>
      </div>
     </div><button id="retry-btn" class="game-font text-2xl px-12 py-4 rounded-lg transition-all duration-300 hover:scale-105 cursor-pointer border-none" style="background: linear-gradient(135deg, #e94560, #dc2626); color: white; box-shadow: 0 4px 20px rgba(233, 69, 96, 0.4);"> TRY AGAIN üîÑ </button>
    </div>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      game_title: 'VICTORY ROYALE SURVIVOR',
      win_message: 'VICTORY ROYALE!',
      primary_color: '#ffd700',
      secondary_color: '#1a1a2e',
      accent_color: '#e94560',
      text_color: '#ffffff',
      surface_color: '#16213e',
      font_family: 'Bebas Neue',
      font_size: 16
    };

    let config = { ...defaultConfig };

    // Game state
    let gameState = {
      health: 100,
      shield: 0,
      alive: 50,
      eliminations: 0,
      playerX: 50,
      playerY: 50,
      stormRadius: 100,
      stormTimer: 30,
      gameTime: 0,
      isRunning: false,
      enemies: [],
      loot: [],
      keys: {}
    };

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          applyConfig();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.secondary_color || defaultConfig.secondary_color,
              set: (value) => { cfg.secondary_color = value; window.elementSdk.setConfig({ secondary_color: value }); }
            },
            {
              get: () => cfg.surface_color || defaultConfig.surface_color,
              set: (value) => { cfg.surface_color = value; window.elementSdk.setConfig({ surface_color: value }); }
            },
            {
              get: () => cfg.text_color || defaultConfig.text_color,
              set: (value) => { cfg.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
            },
            {
              get: () => cfg.primary_color || defaultConfig.primary_color,
              set: (value) => { cfg.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (value) => { cfg.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => cfg.font_family || defaultConfig.font_family,
            set: (value) => { cfg.font_family = value; window.elementSdk.setConfig({ font_family: value }); }
          },
          fontSizeable: {
            get: () => cfg.font_size || defaultConfig.font_size,
            set: (value) => { cfg.font_size = value; window.elementSdk.setConfig({ font_size: value }); }
          }
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['game_title', cfg.game_title || defaultConfig.game_title],
          ['win_message', cfg.win_message || defaultConfig.win_message]
        ])
      });
    }

    function applyConfig() {
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;

      // Update title
      const titleDisplay = document.getElementById('title-display');
      if (titleDisplay) {
        titleDisplay.textContent = config.game_title || defaultConfig.game_title;
        titleDisplay.style.color = primaryColor;
        titleDisplay.style.fontFamily = `${fontFamily}, Bebas Neue, sans-serif`;
        titleDisplay.style.fontSize = `${baseSize * 3}px`;
      }

      // Update victory title
      const victoryTitle = document.getElementById('victory-title');
      if (victoryTitle) {
        victoryTitle.textContent = config.win_message || defaultConfig.win_message;
        victoryTitle.style.color = primaryColor;
        victoryTitle.style.fontFamily = `${fontFamily}, Bebas Neue, sans-serif`;
        victoryTitle.style.fontSize = `${baseSize * 3.5}px`;
      }

      // Update backgrounds
      const startScreen = document.getElementById('start-screen');
      if (startScreen) {
        startScreen.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${surfaceColor} 50%, ${secondaryColor} 100%)`;
      }

      const gameScreen = document.getElementById('game-screen');
      if (gameScreen) {
        gameScreen.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${surfaceColor} 100%)`;
      }

      const victoryScreen = document.getElementById('victory-screen');
      if (victoryScreen) {
        victoryScreen.style.background = `linear-gradient(135deg, ${secondaryColor} 0%, ${surfaceColor} 100%)`;
      }

      // Update buttons
      const startBtn = document.getElementById('start-btn');
      if (startBtn) {
        startBtn.style.background = `linear-gradient(135deg, ${primaryColor}, ${accentColor})`;
        startBtn.style.color = secondaryColor;
        startBtn.style.fontFamily = `${fontFamily}, Bebas Neue, sans-serif`;
        startBtn.style.fontSize = `${baseSize * 1.5}px`;
      }

      const playAgainBtn = document.getElementById('play-again-btn');
      if (playAgainBtn) {
        playAgainBtn.style.background = `linear-gradient(135deg, ${primaryColor}, ${accentColor})`;
        playAgainBtn.style.color = secondaryColor;
        playAgainBtn.style.fontFamily = `${fontFamily}, Bebas Neue, sans-serif`;
      }

      // Update accent colored elements
      const accentTexts = document.querySelectorAll('[data-accent]');
      accentTexts.forEach(el => {
        el.style.color = accentColor;
      });
    }

    // Screen management
    function showScreen(screenId) {
      ['start-screen', 'game-screen', 'victory-screen', 'gameover-screen'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.classList.add('hidden');
          el.classList.remove('flex');
        }
      });
      const screen = document.getElementById(screenId);
      if (screen) {
        screen.classList.remove('hidden');
        screen.classList.add('flex');
      }
    }

    // Initialize game
    function initGame() {
      gameState = {
        health: 100,
        shield: 0,
        alive: 50,
        eliminations: 0,
        playerX: 50,
        playerY: 50,
        stormRadius: 100,
        stormTimer: 30,
        gameTime: 0,
        isRunning: true,
        enemies: [],
        loot: [],
        keys: {}
      };

      // Spawn initial enemies
      for (let i = 0; i < 10; i++) {
        spawnEnemy();
      }

      // Spawn initial loot
      for (let i = 0; i < 8; i++) {
        spawnLoot();
      }

      updateUI();
      renderEntities();
    }

    function spawnEnemy() {
      const enemy = {
        id: Math.random().toString(36).substr(2, 9),
        x: Math.random() * 80 + 10,
        y: Math.random() * 80 + 10,
        emoji: ['ü§ñ', 'üëæ', 'üëπ', 'üßü'][Math.floor(Math.random() * 4)],
        speed: 0.1 + Math.random() * 0.15
      };
      gameState.enemies.push(enemy);
    }

    function spawnLoot() {
      const types = [
        { emoji: 'üíä', type: 'health', value: 25 },
        { emoji: 'üõ°Ô∏è', type: 'shield', value: 25 },
        { emoji: '‚≠ê', type: 'star', value: 50 },
        { emoji: 'üì¶', type: 'chest', value: 0 },
        { emoji: 'üéØ', type: 'weapon', value: 1 }
      ];
      const lootType = types[Math.floor(Math.random() * types.length)];
      const loot = {
        id: Math.random().toString(36).substr(2, 9),
        x: Math.random() * 80 + 10,
        y: Math.random() * 80 + 10,
        ...lootType
      };
      gameState.loot.push(loot);
    }

    function updateUI() {
      document.getElementById('health-bar').style.width = `${gameState.health}%`;
      document.getElementById('health-text').textContent = Math.round(gameState.health);
      document.getElementById('shield-bar').style.width = `${gameState.shield}%`;
      document.getElementById('shield-text').textContent = Math.round(gameState.shield);
      document.getElementById('alive-count').textContent = gameState.alive;
      document.getElementById('elim-count').textContent = gameState.eliminations;
      document.getElementById('storm-timer').textContent = `${Math.max(0, Math.round(gameState.stormTimer))}s`;

      // Update storm visual
      const stormZone = document.getElementById('storm-zone');
      if (stormZone) {
        // Storm size changes are animated via CSS, no need for manual updates
      }
    }

    function renderEntities() {
      const lootContainer = document.getElementById('loot-container');
      const enemyContainer = document.getElementById('enemy-container');

      // Render loot
      lootContainer.innerHTML = gameState.loot.map(l => `
        <div class="absolute text-2xl loot-float" style="left: ${l.x}%; top: ${l.y}%; transform: translate(-50%, -50%);">
          ${l.emoji}
        </div>
      `).join('');

      // Render enemies
      enemyContainer.innerHTML = gameState.enemies.map(e => `
        <div class="absolute text-2xl" style="left: ${e.x}%; top: ${e.y}%; transform: translate(-50%, -50%);">
          ${e.emoji}
        </div>
      `).join('');

      // Update player position
      const player = document.getElementById('player');
      if (player) {
        player.style.left = `${gameState.playerX}%`;
        player.style.top = `${gameState.playerY}%`;
      }
    }

    function showEffect(x, y, text, color) {
      const container = document.getElementById('effects-container');
      const effect = document.createElement('div');
      effect.className = 'absolute text-xl font-bold';
      effect.style.cssText = `left: ${x}%; top: ${y}%; transform: translate(-50%, -50%); color: ${color}; animation: float 0.5s ease-out forwards; pointer-events: none;`;
      effect.textContent = text;
      container.appendChild(effect);
      setTimeout(() => effect.remove(), 500);
    }

    function gameLoop() {
      if (!gameState.isRunning) return;

      // Handle movement
      const speed = 0.8;
      if (gameState.keys['ArrowUp'] || gameState.keys['w'] || gameState.keys['W']) {
        gameState.playerY = Math.max(5, gameState.playerY - speed);
      }
      if (gameState.keys['ArrowDown'] || gameState.keys['s'] || gameState.keys['S']) {
        gameState.playerY = Math.min(95, gameState.playerY + speed);
      }
      if (gameState.keys['ArrowLeft'] || gameState.keys['a'] || gameState.keys['A']) {
        gameState.playerX = Math.max(5, gameState.playerX - speed);
      }
      if (gameState.keys['ArrowRight'] || gameState.keys['d'] || gameState.keys['D']) {
        gameState.playerX = Math.min(95, gameState.playerX + speed);
      }

      // Move enemies toward player
      gameState.enemies.forEach(enemy => {
        const dx = gameState.playerX - enemy.x;
        const dy = gameState.playerY - enemy.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist > 0) {
          enemy.x += (dx / dist) * enemy.speed;
          enemy.y += (dy / dist) * enemy.speed;
        }
      });

      // Check loot collection
      gameState.loot = gameState.loot.filter(loot => {
        const dx = gameState.playerX - loot.x;
        const dy = gameState.playerY - loot.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist < 5) {
          if (loot.type === 'health') {
            gameState.health = Math.min(100, gameState.health + loot.value);
            showEffect(loot.x, loot.y, `+${loot.value}‚ù§Ô∏è`, '#22c55e');
          } else if (loot.type === 'shield') {
            gameState.shield = Math.min(100, gameState.shield + loot.value);
            showEffect(loot.x, loot.y, `+${loot.value}üõ°Ô∏è`, '#3b82f6');
          } else if (loot.type === 'star') {
            gameState.health = Math.min(100, gameState.health + 50);
            gameState.shield = Math.min(100, gameState.shield + 50);
            showEffect(loot.x, loot.y, '+50‚≠ê', '#ffd700');
          } else if (loot.type === 'weapon') {
            // Eliminate nearby enemies
            gameState.enemies = gameState.enemies.filter(e => {
              const eDist = Math.sqrt((gameState.playerX - e.x) ** 2 + (gameState.playerY - e.y) ** 2);
              if (eDist < 20) {
                gameState.eliminations++;
                gameState.alive--;
                showEffect(e.x, e.y, 'üí•', '#e94560');
                return false;
              }
              return true;
            });
            showEffect(loot.x, loot.y, 'üéØ', '#ffd700');
          } else if (loot.type === 'chest') {
            // Random bonus
            const bonus = Math.random();
            if (bonus < 0.5) {
              gameState.health = Math.min(100, gameState.health + 30);
              showEffect(loot.x, loot.y, '+30‚ù§Ô∏è', '#22c55e');
            } else {
              gameState.shield = Math.min(100, gameState.shield + 30);
              showEffect(loot.x, loot.y, '+30üõ°Ô∏è', '#3b82f6');
            }
          }
          return false;
        }
        return true;
      });

      // Check enemy collision
      gameState.enemies = gameState.enemies.filter(enemy => {
        const dx = gameState.playerX - enemy.x;
        const dy = gameState.playerY - enemy.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        
        if (dist < 4) {
          // Take damage
          const damage = 15;
          if (gameState.shield > 0) {
            gameState.shield = Math.max(0, gameState.shield - damage);
            showEffect(enemy.x, enemy.y, `-${damage}üõ°Ô∏è`, '#3b82f6');
          } else {
            gameState.health -= damage;
            showEffect(enemy.x, enemy.y, `-${damage}‚ù§Ô∏è`, '#e94560');
          }
          
          // Eliminate enemy on contact
          gameState.eliminations++;
          gameState.alive--;
          showEffect(enemy.x, enemy.y, 'üí•', '#e94560');
          return false;
        }
        return true;
      });

      // Check storm damage
      const distFromCenter = Math.sqrt((gameState.playerX - 50) ** 2 + (gameState.playerY - 50) ** 2);
      const maxSafeDistance = gameState.stormRadius * 0.35;
      
      if (distFromCenter > maxSafeDistance) {
        const stormDamage = 0.5;
        if (gameState.shield > 0) {
          gameState.shield = Math.max(0, gameState.shield - stormDamage);
        } else {
          gameState.health -= stormDamage;
        }
      }

      // Check death
      if (gameState.health <= 0) {
        gameState.isRunning = false;
        document.getElementById('go-elims').textContent = gameState.eliminations;
        document.getElementById('place-num').textContent = gameState.alive;
        showScreen('gameover-screen');
        return;
      }

      // Check victory
      if (gameState.alive <= 1) {
        gameState.isRunning = false;
        const minutes = Math.floor(gameState.gameTime / 60);
        const seconds = Math.floor(gameState.gameTime % 60);
        document.getElementById('final-elims').textContent = gameState.eliminations;
        document.getElementById('final-time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        showScreen('victory-screen');
        return;
      }

      // Spawn new enemies and loot periodically
      if (Math.random() < 0.02 && gameState.enemies.length < 15) {
        spawnEnemy();
      }
      if (Math.random() < 0.015 && gameState.loot.length < 12) {
        spawnLoot();
      }

      // Auto-eliminate AI enemies periodically
      if (Math.random() < 0.01 && gameState.alive > 2) {
        gameState.alive--;
      }

      updateUI();
      renderEntities();
      requestAnimationFrame(gameLoop);
    }

    // Storm timer
    function stormLoop() {
      if (!gameState.isRunning) return;
      
      gameState.gameTime += 0.1;
      gameState.stormTimer -= 0.1;
      
      if (gameState.stormTimer <= 0) {
        gameState.stormRadius = Math.max(20, gameState.stormRadius - 5);
        gameState.stormTimer = 15;
      }
      
      setTimeout(stormLoop, 100);
    }

    // Event listeners
    document.getElementById('start-btn').addEventListener('click', () => {
      showScreen('game-screen');
      initGame();
      gameLoop();
      stormLoop();
    });

    document.getElementById('play-again-btn').addEventListener('click', () => {
      showScreen('game-screen');
      initGame();
      gameLoop();
      stormLoop();
    });

    document.getElementById('retry-btn').addEventListener('click', () => {
      showScreen('game-screen');
      initGame();
      gameLoop();
      stormLoop();
    });

    // Keyboard controls
    document.addEventListener('keydown', (e) => {
      gameState.keys[e.key] = true;
    });

    document.addEventListener('keyup', (e) => {
      gameState.keys[e.key] = false;
    });

    // Mobile controls
    document.querySelectorAll('.control-btn').forEach(btn => {
      const dir = btn.dataset.dir;
      
      const startMove = () => {
        if (dir === 'up') gameState.keys['ArrowUp'] = true;
        if (dir === 'down') gameState.keys['ArrowDown'] = true;
        if (dir === 'left') gameState.keys['ArrowLeft'] = true;
        if (dir === 'right') gameState.keys['ArrowRight'] = true;
      };
      
      const stopMove = () => {
        if (dir === 'up') gameState.keys['ArrowUp'] = false;
        if (dir === 'down') gameState.keys['ArrowDown'] = false;
        if (dir === 'left') gameState.keys['ArrowLeft'] = false;
        if (dir === 'right') gameState.keys['ArrowRight'] = false;
      };
      
      btn.addEventListener('mousedown', startMove);
      btn.addEventListener('mouseup', stopMove);
      btn.addEventListener('mouseleave', stopMove);
      btn.addEventListener('touchstart', (e) => { e.preventDefault(); startMove(); });
      btn.addEventListener('touchend', stopMove);
    });

    // Initial config apply
    applyConfig();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ca47ffc62cdfbf2',t:'MTc3MDQ4NDIxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
